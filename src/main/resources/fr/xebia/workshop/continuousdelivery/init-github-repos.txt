#!/bin/bash

# Number of repos to create
#USERS=30
USERS=1

# Clone xebia-petclinic
git clone git@github.com:xebia-france-training/xebia-petclinic-clc

CURRENT_GROUP_ID='xebia.demo.petclinic-clc'

for i in `jot - 1 $USERS`
do

	NEW_GROUP_ID="fr.xebia.demo.petclinic-clc-$i"
	echo "USER $i : NEW_GROUP_ID= $NEW_GROUP_ID"
	REPOSITORY_NAME="xebia-petclinic-$i"

	# create repository
	curl -u 'jmateo:041102xl' http://github.com/api/v2/json/repos/create -F name=$REPOSITORY_NAME

   	# Replace <groupId>fr.xebia.demo.petclinic-clc</groupId> with <groupId>fr.xebia.demo.petclinic-clc-$i</groupId> 	
	cp -rf xebia-petclinic-clc/ $REPOSITORY_NAME
	cd $REPOSITORY_NAME
	sed "s/$CURRENT_GROUP_ID/$NEW_GROUP_ID/g" ./pom.xml > /tmp/temppom.xml
	mv /tmp/temppom.xml ./pom.xml

	# push sources from the cloned repository to the new one that we have just created
	git init
	git add .
	git commit -m "clone xebia-petclinic-clc to $REPOSITORY_NAME"  
	git remote add $REPOSITORY_NAME git@github.com:jmateo/$REPOSITORY_NAME.git
	git push -u $REPOSITORY_NAME master

	cd ..	
done